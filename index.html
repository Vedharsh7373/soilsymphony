<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SoilSymphony ‚Äì Evolution & Harmony</title>
  <style>
    :root {
      --bg-dark: #0a0e1a; --bg-card: #12172b; --bg-elevated: #1a2035;
      --accent-green: #22c55e; --accent-blue: #3b82f6; --accent-red: #ef4444;
      --text-primary: #f1f5f9; --text-secondary: #94a3b8; --border: #1e293b;
    }
    body { font-family: 'Segoe UI', sans-serif; background: var(--bg-dark); color: var(--text-primary); padding: 20px; }
    .container { max-width: 900px; margin: 0 auto; }
    
    /* GAME STYLES */
    .game-panel {
      background: radial-gradient(circle at center, #1a2a4a 0%, var(--bg-card) 100%);
      border: 2px solid var(--accent-blue); border-radius: 20px;
      padding: 30px; text-align: center; margin-bottom: 20px;
    }
    #plant-avatar { font-size: 100px; margin: 10px 0; display: inline-block; transition: all 0.5s; }
    .bar { width: 100%; height: 12px; background: #000; border-radius: 6px; margin: 10px 0; overflow: hidden; }
    .fill { height: 100%; width: 0%; transition: width 0.4s; }
    
    .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 20px; }
    .btn { padding: 12px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; width: 100%; background: var(--accent-blue); color: white; }
    .log { background: #000; color: #55ff55; font-family: monospace; font-size: 11px; height: 100px; overflow-y: auto; padding: 10px; border-radius: 10px; margin-top: 20px; }
  </style>
</head>
<body>

<div class="container">
  <div class="game-panel">
    <div style="font-weight: bold; color: var(--accent-blue);">PLANT LEVEL: <span id="lvl">1</span></div>
    <div id="plant-avatar">üå±</div>
    <h2 id="mood">Connect Arduino to Begin</h2>
    
    <div style="display:flex; justify-content:space-between; font-size:12px;"><span>HEALTH (HP)</span><span id="hp-txt">100%</span></div>
    <div class="bar"><div id="hp-fill" class="fill" style="background: var(--accent-red); width: 100%;"></div></div>
    
    <div style="display:flex; justify-content:space-between; font-size:12px;"><span>GROWTH (XP)</span><span id="xp-txt">0%</span></div>
    <div class="bar"><div id="xp-fill" class="fill" style="background: var(--accent-green); width: 0%;"></div></div>
  </div>

  <div class="grid">
    <div class="card">
      <h3>üîå Serial Connection</h3>
      <button class="btn" id="connectBtn">Connect Arduino</button>
      <div id="status" style="margin-top:10px; font-size:12px; color:var(--text-secondary);">Status: Disconnected</div>
    </div>
    <div class="card">
      <h3>üíß Soil Sensor</h3>
      <div id="soil-val" style="font-size: 32px; font-weight: bold;">---</div>
      <div id="state-txt" style="color: var(--accent-blue);">Waiting for data...</div>
    </div>
  </div>

  <div class="log" id="sys-log">Welcome to SoilSymphony. Timer and Music systems active...</div>
</div>

<script>
  let port, reader, hp = 100, xp = 0, level = 1, isDead = false;
  let wetMusic, dryAlert, currentlyPlaying = null;

  const URLS = {
    wet: 'https://raw.githubusercontent.com/Vedharsh7373/soilsymphony/main/432%20Hz%20-%20Positive%20Energy%20Meditation%20Music%20Deep%20Healing%20Music%20for%20The%20Body%20and%20Soul.mp3',
    dry: 'https://raw.githubusercontent.com/Vedharsh7373/soilsymphony/main/Record%20(online-voice-recorder.com).mp3'
  };

  function initAudio() {
    if (!wetMusic) {
      wetMusic = new Audio(URLS.wet); wetMusic.loop = true;
      dryAlert = new Audio(URLS.dry); dryAlert.loop = true;
    }
  }

  function handleIncomingData(line) {
    if (isDead) return;
    const logEl = document.getElementById('sys-log');
    logEl.innerHTML = `[${new Date().toLocaleTimeString()}] ${line}<br>${logEl.innerHTML}`;

    if (line.includes("Soil:")) {
      const val = parseInt(line.match(/\d+/)[0]);
      document.getElementById('soil-val').textContent = val;
      const avatar = document.getElementById('plant-avatar');
      const mood = document.getElementById('mood');

      if (line.includes("STATE:WET")) {
        hp = Math.min(100, hp + 2); // 432Hz heals
        mood.textContent = "Soothing... (Healing)";
        avatar.style.transform = "scale(1.1)";
        playMusic('wet');
      } else if (line.includes("STATE:DRY")) {
        hp -= 4; // Dryness hurts
        mood.textContent = "THIRSTY! (Losing Health)";
        avatar.style.transform = "scale(0.8) rotate(10deg)";
        playMusic('dry');
      } else {
        xp += 5; // Normal moisture gives XP
        mood.textContent = "Perfect Vibe (Growing)";
        avatar.style.transform = "scale(1)";
        stopMusic();
      }

      if (hp <= 0) {
        isDead = true;
        avatar.textContent = "üíÄ";
        mood.textContent = "GAME OVER";
        stopMusic();
      }
      if (xp >= 100) {
        level++; xp = 0;
        document.getElementById('lvl').textContent = level;
        const icons = ["üå±", "üåø", "ü™¥", "üçÄ", "üå∏", "üåª", "üå≥", "üåü"];
        avatar.textContent = icons[Math.min(level-1, 7)];
      }
      updateUI();
    }
  }

  function updateUI() {
    document.getElementById('hp-fill').style.width = hp + "%";
    document.getElementById('hp-txt').textContent = hp + "%";
    document.getElementById('xp-fill').style.width = xp + "%";
    document.getElementById('xp-txt').textContent = xp + "%";
  }

  function playMusic(type) {
    if (currentlyPlaying === type) return;
    stopMusic();
    if (type === 'wet') wetMusic.play(); else dryAlert.play();
    currentlyPlaying = type;
  }

  function stopMusic() {
    if (wetMusic) wetMusic.pause(); if (dryAlert) dryAlert.pause();
    currentlyPlaying = null;
  }

  async function connect() {
    initAudio();
    port = await navigator.serial.requestPort();
    await port.open({ baudRate: 115200 });
    document.getElementById('status').textContent = "Status: Connected";
    const decoder = new TextDecoderStream();
    port.readable.pipeTo(decoder.writable);
    reader = decoder.readable.getReader();
    readLoop();
  }

  async function readLoop() {
    let buffer = "";
    while (true) {
      const { value, done } = await reader.read();
      buffer += value;
      let lines = buffer.split("\n");
      buffer = lines.pop();
      for (let l of lines) handleIncomingData(l.trim());
    }
  }

  document.getElementById('connectBtn').addEventListener('click', connect);
  document.addEventListener('click', initAudio, { once: true });
</script>
</body>
</html>
